<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Nutrition Tracker</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 20px auto;
      padding: 0 20px;
    }
    input, select, button {
      margin: 5px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
    }
    .totals {
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h2>Nutrition Tracker</h2>

  <label for="date">Date:</label>
  <input type="date" id="log-date" />

  <br><br>

  <input type="text" id="food-name" placeholder="Food Name" list="food-list">
  <input type="number" id="grams" placeholder="Grams" min="0">
  <button onclick="addEntry()">Add</button>
  <button onclick="exportLogs()">Export Logs</button>

  <datalist id="food-list"></datalist>

  <table id="log-table">
    <thead>
      <tr>
        <th>Food</th><th>Grams</th><th>Calories</th><th>Protein (g)</th><th>Carbs (g)</th><th>Fat (g)</th><th>Actions</th>
      </tr>
    </thead>
    <tbody></tbody>
    <tfoot>
      <tr class="totals">
        <td colspan="2">Total</td>
        <td id="total-calories">0</td>
        <td id="total-protein">0</td>
        <td id="total-carbs">0</td>
        <td id="total-fat">0</td>
        <td></td>
      </tr>
    </tfoot>
  </table>

  <canvas id="nutritionChart" height="100"></canvas>

  <script>
    const foodDB = {
      "chicken breast": { cal: 165, protein: 31, carbs: 0, fat: 3.6 },
      "steak": { cal: 271, protein: 25, carbs: 0, fat: 19 },
      "ground beef": { cal: 250, protein: 26, carbs: 0, fat: 17 },
      "chicken drumstick": { cal: 174, protein: 22, carbs: 0, fat: 9 },
      "salmon": { cal: 208, protein: 20, carbs: 0, fat: 13 },
      "tuna": { cal: 132, protein: 28, carbs: 0, fat: 1.3 },
      "shrimp": { cal: 99, protein: 24, carbs: 0.2, fat: 0.3 },
      "cheese": { cal: 402, protein: 25, carbs: 1.3, fat: 33 },
      "yogurt": { cal: 59, protein: 10, carbs: 3.6, fat: 0.4 },
      "milk": { cal: 42, protein: 3.4, carbs: 5, fat: 1 },
      "banana": { cal: 89, protein: 1.1, carbs: 23, fat: 0.3 },
      "apple": { cal: 52, protein: 0.3, carbs: 14, fat: 0.2 },
      "orange": { cal: 47, protein: 0.9, carbs: 12, fat: 0.1 },
      "broccoli": { cal: 34, protein: 2.8, carbs: 7, fat: 0.4 },
      "spinach": { cal: 23, protein: 2.9, carbs: 3.6, fat: 0.4 },
      "carrots": { cal: 41, protein: 0.9, carbs: 10, fat: 0.2 },
      "brown rice": { cal: 111, protein: 2.6, carbs: 23, fat: 0.9 },
      "oats": { cal: 389, protein: 17, carbs: 66, fat: 7 },
      "bread": { cal: 265, protein: 9, carbs: 49, fat: 3.2 },
      "lentils": { cal: 116, protein: 9, carbs: 20, fat: 0.4 },
      "black beans": { cal: 132, protein: 8.9, carbs: 24, fat: 0.5 },
      "chickpeas": { cal: 164, protein: 8.9, carbs: 27, fat: 2.6 },
      "almonds": { cal: 579, protein: 21, carbs: 22, fat: 50 },
      "peanut butter": { cal: 588, protein: 25, carbs: 20, fat: 50 }
    };

    const logTable = document.querySelector("#log-table tbody");
    const totals = {
      cal: document.getElementById("total-calories"),
      protein: document.getElementById("total-protein"),
      carbs: document.getElementById("total-carbs"),
      fat: document.getElementById("total-fat")
    };
    const dateInput = document.getElementById("log-date");
    let currentDate = new Date().toISOString().slice(0, 10);
    dateInput.value = currentDate;
    dateInput.addEventListener('change', () => {
      currentDate = dateInput.value;
      renderLog();
    });

    let chart;
    document.addEventListener("DOMContentLoaded", () => {
      const datalist = document.getElementById("food-list");
      Object.keys(foodDB).forEach(food => {
        const option = document.createElement("option");
        option.value = food;
        datalist.appendChild(option);
      });
      renderLog();
      renderChart();
    });

    function addEntry() {
      const food = document.getElementById("food-name").value.toLowerCase();
      const grams = parseFloat(document.getElementById("grams").value);
      if (!foodDB[food] || isNaN(grams)) return alert("Invalid input");

      const ratio = grams / 100;
      const entry = {
        food,
        grams,
        calories: +(foodDB[food].cal * ratio).toFixed(2),
        protein: +(foodDB[food].protein * ratio).toFixed(2),
        carbs: +(foodDB[food].carbs * ratio).toFixed(2),
        fat: +(foodDB[food].fat * ratio).toFixed(2)
      };

      const logs = getLogs();
      logs.push(entry);
      saveLogs(logs);
      renderLog();
      renderChart();
    }

    function renderLog() {
      const logs = getLogs();
      logTable.innerHTML = "";
      let tCal = 0, tP = 0, tC = 0, tF = 0;

      logs.forEach((entry, idx) => {
        const row = logTable.insertRow();
        row.innerHTML = `
          <td>${entry.food}</td>
          <td>${entry.grams}</td>
          <td>${entry.calories}</td>
          <td>${entry.protein}</td>
          <td>${entry.carbs}</td>
          <td>${entry.fat}</td>
          <td>
            <button onclick="editEntry(${idx})">Edit</button>
            <button onclick="deleteEntry(${idx})">X</button>
          </td>
        `;
        tCal += entry.calories;
        tP += entry.protein;
        tC += entry.carbs;
        tF += entry.fat;
      });

      totals.cal.textContent = tCal.toFixed(2);
      totals.protein.textContent = tP.toFixed(2);
      totals.carbs.textContent = tC.toFixed(2);
      totals.fat.textContent = tF.toFixed(2);
    }

    function editEntry(index) {
      const logs = getLogs();
      const item = logs[index];
      document.getElementById("food-name").value = item.food;
      document.getElementById("grams").value = item.grams;
      logs.splice(index, 1);
      saveLogs(logs);
      renderLog();
      renderChart();
    }

    function deleteEntry(index) {
      const logs = getLogs();
      logs.splice(index, 1);
      saveLogs(logs);
      renderLog();
      renderChart();
    }

    function getLogs() {
      const key = "log-" + currentDate;
      return JSON.parse(localStorage.getItem(key)) || [];
    }

    function saveLogs(data) {
      const key = "log-" + currentDate;
      localStorage.setItem(key, JSON.stringify(data));
    }

    function exportLogs() {
      const allKeys = Object.keys(localStorage).filter(k => k.startsWith("log-"));
      const allLogs = {};
      allKeys.forEach(k => {
        allLogs[k] = JSON.parse(localStorage.getItem(k));
      });

      const blob = new Blob([JSON.stringify(allLogs, null, 2)], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "nutrition_logs.json";
      a.click();
    }

    function renderChart() {
      const labels = [], calories = [], proteins = [];
      Object.keys(localStorage).filter(k => k.startsWith("log-")).sort().forEach(dateKey => {
        const entries = JSON.parse(localStorage.getItem(dateKey));
        labels.push(dateKey.replace("log-", ""));
        calories.push(entries.reduce((sum, e) => sum + e.calories, 0));
        proteins.push(entries.reduce((sum, e) => sum + e.protein, 0));
      });

      const ctx = document.getElementById("nutritionChart").getContext("2d");
      if (chart) chart.destroy();
      chart = new Chart(ctx, {
        type: 'line',
        data: {
          labels,
          datasets: [
            {
              label: "Calories",
              data: calories,
              borderColor: "red",
              fill: false
            },
            {
              label: "Protein (g)",
              data: proteins,
              borderColor: "blue",
              fill: false
            }
          ]
        },
        options: {
          responsive: true,
          scales: {
            y: { beginAtZero: true }
          }
        }
      });
    }
  </script>
</body>
</html>
