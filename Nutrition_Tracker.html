<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Nutrition Tracker</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f4f4f4;
    }
    h2 {
      margin-top: 30px;
    }
    .section {
      margin-bottom: 25px;
      padding: 15px;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }
    label, input, select, button {
      display: block;
      margin: 5px 0;
    }
    table {
      width: 100%;
      margin-top: 10px;
      border-collapse: collapse;
    }
    th, td {
      padding: 8px;
      border: 1px solid #ccc;
    }
    canvas {
      display: block;
      margin: 40px auto;
      max-width: 600px;
    }
    .center {
      text-align: center;
    }
  </style>
</head>
<body>

  <h1>Nutrition Tracker</h1>

  <div class="section">
    <label>Date: <input type="date" id="logDate" /></label>

    <label>Food:
      <input type="text" id="foodName" placeholder="Enter food name" list="foodList">
      <datalist id="foodList">
        <option value="Chicken Breast">
        <option value="Steak">
        <option value="Ground Beef">
        <option value="Chicken Drumsticks">
        <option value="Salmon">
        <option value="Tofu">
        <option value="Eggs">
        <option value="Protein Shake">
      </datalist>
    </label>

    <label>Calories: <input type="number" id="calories" /></label>
    <label>Protein (g): <input type="number" id="protein" /></label>
    <label>Fat (g): <input type="number" id="fat" /></label>
    <label>Carbs (g): <input type="number" id="carbs" /></label>
    <button onclick="addEntry()">Add Entry</button>
  </div>

  <div class="section">
    <h2>Logged Entries</h2>
    <table id="logTable">
      <thead>
        <tr>
          <th>Date</th><th>Food</th><th>Calories</th><th>Protein</th><th>Fat</th><th>Carbs</th><th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <div class="section center">
    <h2>Calories & Protein Over Time</h2>
    <canvas id="logChart"></canvas>
  </div>

  <script>
    let logs = JSON.parse(localStorage.getItem('nutritionLogs')) || [];

    const BMR = 1506;
    const TDEE = 2334;

    function addEntry() {
      const date = document.getElementById("logDate").value;
      const food = document.getElementById("foodName").value.trim();
      const calories = parseFloat(document.getElementById("calories").value);
      const protein = parseFloat(document.getElementById("protein").value);
      const fat = parseFloat(document.getElementById("fat").value);
      const carbs = parseFloat(document.getElementById("carbs").value);

      if (!date || !food || isNaN(calories)) return alert("Please enter all fields!");

      logs.push({ date, food, calories, protein, fat, carbs });
      saveLogs();
      displayLogs();
      drawChart();
    }

    function deleteEntry(index) {
      logs.splice(index, 1);
      saveLogs();
      displayLogs();
      drawChart();
    }

    function editEntry(index) {
      const entry = logs[index];
      document.getElementById("logDate").value = entry.date;
      document.getElementById("foodName").value = entry.food;
      document.getElementById("calories").value = entry.calories;
      document.getElementById("protein").value = entry.protein;
      document.getElementById("fat").value = entry.fat;
      document.getElementById("carbs").value = entry.carbs;
      deleteEntry(index);
    }

    function saveLogs() {
      localStorage.setItem("nutritionLogs", JSON.stringify(logs));
    }

    function displayLogs() {
      const tbody = document.querySelector("#logTable tbody");
      tbody.innerHTML = "";
      logs.forEach((log, i) => {
        const row = tbody.insertRow();
        row.innerHTML = `
          <td>${log.date}</td>
          <td>${log.food}</td>
          <td>${log.calories}</td>
          <td>${log.protein}</td>
          <td>${log.fat}</td>
          <td>${log.carbs}</td>
          <td>
            <button onclick="editEntry(${i})">Edit</button>
            <button onclick="deleteEntry(${i})">Delete</button>
          </td>
        `;
      });
    }

    function drawChart() {
      const ctx = document.getElementById('logChart').getContext('2d');
      const byDate = {};

      logs.forEach(log => {
        if (!byDate[log.date]) {
          byDate[log.date] = { calories: 0, protein: 0 };
        }
        byDate[log.date].calories += log.calories;
        byDate[log.date].protein += log.protein;
      });

      const dates = Object.keys(byDate).sort();
      const caloriesData = dates.map(d => byDate[d].calories);
      const proteinData = dates.map(d => byDate[d].protein);

      if (window.chartInstance) window.chartInstance.destroy();

      window.chartInstance = new Chart(ctx, {
        type: 'line',
        data: {
          labels: dates,
          datasets: [
            {
              label: 'Calories',
              data: caloriesData,
              borderColor: 'rgba(255,99,132,1)',
              fill: false
            },
            {
              label: 'Protein (g)',
              data: proteinData,
              borderColor: 'rgba(54,162,235,1)',
              fill: false
            },
            {
              label: 'TDEE (2334)',
              data: new Array(dates.length).fill(TDEE),
              borderColor: 'rgba(0,200,0,0.4)',
              borderDash: [5,5],
              label: 'TDEE',
              fill: false
            },
            {
              label: 'BMR (1506)',
              data: new Array(dates.length).fill(BMR),
              borderColor: 'rgba(200,0,0,0.4)',
              borderDash: [5,5],
              fill: false
            }
          ]
        },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: true
            }
          },
          plugins: {
            legend: {
              display: true,
              position: 'top'
            }
          }
        }
      });
    }

    // Add your baseline entry
    if (!logs.some(l => l.food === 'Daily Target')) {
      logs.push({
        date: new Date().toISOString().slice(0, 10),
        food: 'Daily Target',
        calories: 1867,
        protein: 120,
        fat: 77,
        carbs: 173
      });
      saveLogs();
    }

    displayLogs();
    drawChart();
  </script>
</body>
</html>
