<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Nutrition Tracker</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      max-width: 600px;
      margin: auto;
    }
    h2 {
      margin-top: 30px;
    }
    label, input, select, button {
      margin: 5px 0;
      display: block;
      width: 100%;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 6px;
      text-align: center;
    }
    canvas {
      max-width: 100%;
      margin-top: 30px;
    }
    .spacer {
      margin-top: 25px;
      margin-bottom: 15px;
      border-top: 1px solid #ccc;
    }
  </style>
</head>
<body>

  <h1>Nutrition Tracker</h1>

  <label>Date:</label>
  <input type="date" id="date" value="" />

  <div class="spacer"></div>

  <label>Food Name:</label>
  <select id="foodList">
    <option value="">-- Select common food --</option>
    <option value="Chicken Breast">Chicken Breast</option>
    <option value="Steak">Steak</option>
    <option value="Ground Beef">Ground Beef</option>
    <option value="Chicken Drumsticks">Chicken Drumsticks</option>
    <option value="Apple">Apple</option>
    <option value="Egg">Egg</option>
    <option value="Banana">Banana</option>
    <option value="Salmon">Salmon</option>
    <option value="Avocado">Avocado</option>
    <option value="Rice">Rice</option>
    <option value="Sweet Potato">Sweet Potato</option>
    <option value="Protein Shake">Protein Shake</option>
    <option value="Daily Target">Daily Target</option>
  </select>

  <input type="text" id="customFood" placeholder="Or type your own food name" />

  <label>Calories:</label>
  <input type="number" id="calories" />

  <label>Protein (g):</label>
  <input type="number" id="protein" />

  <label>Fat (g):</label>
  <input type="number" id="fat" />

  <label>Carbs (g):</label>
  <input type="number" id="carbs" />

  <button onclick="addEntry()">Add Entry</button>
  <button onclick="exportLogs()">Export Logs</button>
  <button onclick="clearLogs()">Clear All</button>

  <div class="spacer"></div>

  <h2>Log</h2>
  <table id="logTable">
    <thead>
      <tr>
        <th>Date</th><th>Food</th><th>Calories</th><th>Protein</th><th>Fat</th><th>Carbs</th><th>Action</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div class="spacer"></div>

  <h2>Graph</h2>
  <canvas id="caloriesChart"></canvas>

  <script>
    let logs = JSON.parse(localStorage.getItem("nutritionLogs")) || [];

    document.addEventListener("DOMContentLoaded", () => {
      document.getElementById("date").valueAsDate = new Date();
      updateTable();
      updateChart();
    });

    function addEntry() {
      const date = document.getElementById("date").value;
      const food = document.getElementById("customFood").value || document.getElementById("foodList").value;
      const calories = parseInt(document.getElementById("calories").value || 0);
      const protein = parseInt(document.getElementById("protein").value || 0);
      const fat = parseInt(document.getElementById("fat").value || 0);
      const carbs = parseInt(document.getElementById("carbs").value || 0);

      if (!date || !food) {
        alert("Please enter date and food name.");
        return;
      }

      logs.push({ date, food, calories, protein, fat, carbs });
      localStorage.setItem("nutritionLogs", JSON.stringify(logs));
      updateTable();
      updateChart();

      document.getElementById("customFood").value = "";
      document.getElementById("calories").value = "";
      document.getElementById("protein").value = "";
      document.getElementById("fat").value = "";
      document.getElementById("carbs").value = "";
    }

    function updateTable() {
      const tbody = document.querySelector("#logTable tbody");
      tbody.innerHTML = "";
      logs.forEach((entry, index) => {
        const row = `<tr>
          <td>${entry.date}</td>
          <td>${entry.food}</td>
          <td>${entry.calories}</td>
          <td>${entry.protein}</td>
          <td>${entry.fat}</td>
          <td>${entry.carbs}</td>
          <td><button onclick="deleteEntry(${index})">Delete</button></td>
        </tr>`;
        tbody.insertAdjacentHTML("beforeend", row);
      });
    }

    function deleteEntry(index) {
      logs.splice(index, 1);
      localStorage.setItem("nutritionLogs", JSON.stringify(logs));
      updateTable();
      updateChart();
    }

    function exportLogs() {
      const csv = logs.map(entry =>
        `${entry.date},${entry.food},${entry.calories},${entry.protein},${entry.fat},${entry.carbs}`
      );
      csv.unshift("Date,Food,Calories,Protein,Fat,Carbs");
      const blob = new Blob([csv.join("\n")], { type: "text/csv" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "nutrition_log.csv";
      link.click();
    }

    function clearLogs() {
      if (confirm("Clear all logs?")) {
        logs = [];
        localStorage.removeItem("nutritionLogs");
        updateTable();
        updateChart();
      }
    }

    function updateChart() {
      const dailyTotals = {};
      logs.forEach(({ date, calories, protein }) => {
        if (!dailyTotals[date]) dailyTotals[date] = { calories: 0, protein: 0 };
        dailyTotals[date].calories += calories;
        dailyTotals[date].protein += protein;
      });

      const dates = Object.keys(dailyTotals).sort();
      const caloriesData = dates.map(d => dailyTotals[d].calories);
      const proteinData = dates.map(d => dailyTotals[d].protein);

      if (window.chart) window.chart.destroy();
      const ctx = document.getElementById("caloriesChart").getContext("2d");
      window.chart = new Chart(ctx, {
        type: "line",
        data: {
          labels: dates,
          datasets: [
            {
              label: "Calories",
              data: caloriesData,
              borderColor: "red",
              fill: false
            },
            {
              label: "Protein (g)",
              data: proteinData,
              borderColor: "blue",
              fill: false
            }
          ]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { position: "top" },
            title: { display: true, text: "Calories and Protein Over Time" }
          }
        }
      });
    }
  </script>
</body>
</html>
